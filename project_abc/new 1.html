<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TG MiniApp Check Member</title>
</head>
<body>
  <h2>ğŸ” Checking Telegram Membership...</h2>
  <div id="status">Loading...</div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // screen expand à¦•à¦°à§‡ à¦¦à¦¿à¦¬à§‡

    const statusEl = document.getElementById("status");

    // âœ… Step 1: à¦šà§‡à¦• à¦•à¦°à¦¬à§‹ à¦‡à¦‰à¦œà¦¾à¦° Telegram MiniApp à¦¥à§‡à¦•à§‡ à¦à¦¸à§‡à¦›à§‡ à¦•à¦¿à¦¨à¦¾
    if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
      statusEl.innerText = "âŒ Error: Please open this app inside Telegram.";
    } else {
      const user = tg.initDataUnsafe.user;
      const userId = user.id;

      statusEl.innerText = `ğŸ‘¤ User detected: ${user.first_name} (${userId}) \nChecking group membership...`;

      // âœ… Step 2: API call à¦•à¦°à¦¾
      fetch(`https://tg-api-1.jit20.workers.dev?user_id=${userId}`)
        .then(res => res.json())
        .then(data => {
          console.log(data);
          // âœ… Step 3: Response handle à¦•à¦°à¦¾
          if (data.error) {
            statusEl.innerText = `âš ï¸ Error: ${data.error}`;
          } else if (data.success === false && data.reason) {
            statusEl.innerText = `âŒ Telegram API Error: ${data.reason}`;
          } else if (data.success === true && data.member === true) {
            statusEl.innerText = `âœ… Congrats ${user.first_name}, à¦¤à§à¦®à¦¿ à¦—à§à¦°à§à¦ªà§‡à¦° member! ğŸ‰`;
          } else if (data.success === true && data.member === false) {
            statusEl.innerText = `ğŸš« Sorry ${user.first_name}, à¦¤à§à¦®à¦¿ à¦à¦–à¦¨à§‹ à¦—à§à¦°à§à¦ªà§‡ join à¦•à¦°à§‹ à¦¨à¦¿à¥¤`;
          } else if (data.success === false && data.error) {
            statusEl.innerText = `ğŸ”¥ Server Error: ${data.error}`;
          } else {
            statusEl.innerText = "ğŸ¤” Unexpected response!";
          }
        })
        .catch(err => {
          statusEl.innerText = `ğŸ’¥ Network Error: ${err.message}`;
        });
    }
  </script>
</body>
</html>